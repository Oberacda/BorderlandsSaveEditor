language: c++
compiler: gcc

os: linux
dist: bionic

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - gcc-8
      - g++-8
      - libboost-dev
      - doxygen
      - qt5-default
      - qttools5-dev-tools
      - qttools5-dev
      - libqt5gui5
      - libprotobuf-dev
      - protobuf-compiler
      - libprotoc-dev
      - libprotobuf10
      - openssl
      - libcurl4-openssl-dev
      - libelf-dev
      - libdw-dev
      - binutils-dev
      - libiberty-dev
      - googletest
install:
  - wget https://github.com/Kitware/CMake/releases/download/v3.15.4/cmake-3.15.4-Linux-x86_64.sh
  - chmod +x ./cmake-3.15.4-Linux-x86_64.sh
  - sudo sh ./cmake-3.15.4-Linux-x86_64.sh --prefix=/usr/local --skip-license
  - mkdir dependencies
  - cd dependencies
  - wget https://github.com/google/googletest/archive/release-1.10.0.tar.gz
  - tar xzf release-1.10.0.tar.gz
  - cd googletest-release-1.10.0
  - mkdir build
  - cd build
  - /usr/local/bin/cmake -DCMAKE_C_COMPILER=gcc-8 -DCMAKE_CXX_COMPILER=g++-8 ..
  - make
  - sudo make install
  - cd ../..
  - sudo rm -r googletest-release-1.10.0
  - wget https://github.com/SimonKagstrom/kcov/archive/master.tar.gz
  - tar xzf master.tar.gz
  - cd kcov-master
  - mkdir build
  - cd build
  - /usr/local/bin/cmake -DCMAKE_C_COMPILER=gcc-8 -DCMAKE_CXX_COMPILER=g++-8 ..
  - make
  # puts kcov in the default location usually /usr/local/bin/kcov
  - sudo make install
  - cd ../..
  - sudo rm -r kcov-master
  - wget https://github.com/jarro2783/cxxopts/archive/v2.2.0.tar.gz
  - tar xzf v2.2.0.tar.gz
  - cd cxxopts-2.2.0
  - mkdir build
  - cd build
  - /usr/local/bin/cmake -DCMAKE_C_COMPILER=gcc-8 -DCMAKE_CXX_COMPILER=g++-8 ..
  - make
  - sudo make install
  - cd ../../..

script:
  - mkdir build
  - cd build
  - /usr/local/bin/cmake -DCMAKE_C_COMPILER=gcc-8 -DCMAKE_CXX_COMPILER=g++-8 ..
  - make -j4
  - ./bin/Borderlands2SaveLibTest

after_success:
  - mkdir cov
  - /usr/local/bin/kcov --exclude-path=/usr/ --exclude-pattern=.pb.,minilzo,autogen --coveralls-id=$TRAVIS_JOB_ID  --verify cov/ bin/Borderlands2SaveLibTest